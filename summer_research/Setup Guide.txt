Road Test Setup Guide


Environment:

Virtual Machine:  Virtual Box Version 5.1.26 
Operating system:  CentOS Linux release 7.3.1611 (Core)
	Download - https://wiki.centos.org/Download
Omnet Version:  5.1.1
	Download - https://omnetpp.org/omnetpp
	Install Instructions - https://omnetpp.org/doc/omnetpp/InstallGuide.pdf
Sumo Version: 0.30.0
	Download - http://sumo.dlr.de/wiki/Downloads (Version 0.30.0 “Latest Source Tarball”)
	Install Instructions - Read Build and Installation section of README file
Veins Version: 4.6
	Download - http://veins.car2x.org/download/
	Install Instructions - http://veins.car2x.org/tutorial/

Important step! Disable Selinux - https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security-Enhanced_Linux/sect-Security-Enhanced_Linux-Enabling_and_Disabling_SELinux-Disabling_SELinux.html

Additional programs:

Fox Toolkit Version 1.6.54 - done
	Download - http://www.fox-toolkit.org/download.html
	Install - Read INSTALL document 
GDAL Version 2.2.1. - done
	Download - http://trac.osgeo.org/gdal/wiki/DownloadSource
	Install - http://trac.osgeo.org/gdal/wiki/FAQInstallationAndBuilding#FAQ-InstallationandBuilding
OSG Earth Version 2.8. -  done
	Download - http://osgearth.org/
	Install - http://docs.osgearth.org/en/latest/startup.html
OpenSceneGraph Version 3.4.0 - done
	Download - http://www.openscenegraph.org/index.php/download-section/stable-releases
	Install - Read the README in file
QT5 - done
	Download - https://www.qt.io/download-open-source/?hsCtaTracking=f977210e-de67-475f-a32b-65cec207fd03%7Cd62710cd-e1db-46aa-8d4d-2f1c1ffdacea#section-2
	Install - ./configure; gmake; gmake install
	Special - set QT_PATH in configure.user to where you installed QT5

Packages to Install:

For Veins:

build-essential gcc g++ bison flex perl tcl-dev tk-dev blt libxml2-dev zlib1g-dev default-jre doxygen graphviz libwebkitgtk-1.0-0 openmpi-bin libopenmpi-dev libpcap-dev autoconf automake libtool libproj-dev libgdal1-dev libfox-1.6-dev libgdal-dev libxerces-c-dev qt4-dev-tools

For Omnet: 

make gcc gcc-c++ bison flex perl tcl-devel tk-devel qt-devel libxml2-devel zlib-devel java doxygen graphviz openmpi-devel libpcap-devel


SPECIAL:

If you get a fatal error referencing …’GLIBCXX_3.4.20’ not found… This webpage will solve the problem - https://groups.google.com/forum/#!topic/omnetpp/GXEx7TH0OW0


R Studio

R Studio is used to process the data from the sensors in our test platform.  The primary packages we use are:

Mysql XXXXX
Splining XXXXX

We use Mysql to connect to our db and we use splining to fit a line though our data to fill in throughput information between datapoints.


Open Street Map

Open Street Map is used to generate maps from our testbed to be imported into Omnet++ for simulating.  In order to find the path that a test trip has taken, first we export a .csv of latitudes and longitudes from the dataset.  These can be imported into Google Earth with a .kml file.  There is a handy tool for converting latitudes and longitudes to .kml files here - https://www.earthpoint.us/ExcelToKml.aspx.  You can sign up for a free account if you let the owner of the site know you are a researcher.

Once you have the path of the drive, you can use Open Street Map to select the particular path of the drive you want.  However, OSM only lets you download fully established street maps which include information like points of interest and walking paths that actually hinder the simulation process.  The way around this is to use a web app called Overpass Turbo (https://overpass-turbo.eu/) and download a program called JOSM (https://josm.openstreetmap.de/).

Overpass Turbo is a great tool for exporting specific data from OSM maps.  Using JOSM, you can then edit out any of the extra information that you don’t want included in your simulation.  Overpass Turbo will help you to narrow down 90% of the data that OSM has on a specific area and JOSM will allow you to eliminate the extra bits of data that don’t pertain to your specific drive route, so you can have a precise and clean simulation environment.

First in Overpass, you can use the Wizard to highlight only the highways and roads in a specific map area.  The code we used was:

/*
This has been generated by the overpass-turbo wizard.
The original search was:
“highway=secondary”
*/
[out:xml]/*fixed by auto repair*/[timeout:25];
// gather results
(
  // query part for: “highway=secondary”
  node["highway"="secondary"]({{bbox}});
  way["highway"="secondary"]({{bbox}});
  relation["highway"="secondary"]({{bbox}});
  // query part for: “highway=motorway”
  node["highway"="motorway"]({{bbox}});
  way["highway"="motorway"]({{bbox}});
  relation["highway"="motorway"]({{bbox}});
  // query part for: “highway=primary”
  node["highway"="primary"]({{bbox}});
  way["highway"="primary"]({{bbox}});
  relation["highway"="primary"]({{bbox}});
);
// print results
out meta;/*fixed by auto repair*/
>;
out meta qt;/*fixed by auto repair*/

However, you can add additional road qualifiers to include other roads that may be on your route.     Here is a list of keys that can help you identify the kind of road you want to highlight:  http://wiki.openstreetmap.org/wiki/Key%3ahighway.

Once you have a large map that only includes the type of roads you want to use in your simulation, you need to reduce this map to only include the exact roads in your drive.  You can do this with JOSM.  First, start JOSM and click the icon on the top toolbar that has white switches for an image.  Next, select the button on the left that is second from the bottom.  Now, check the box to Enable Remote Control.

With Remote Control enabled, you will be able to use the, “load data into an OSM editor:” option for exporting from Overpass Turbo.  To do this, make sure JOSM is running and you have your edited map pulled up in Overpass.  Select the Export button on the top of Overpass.  Then click the JOSM option next to, “load data into an OSM editor:”.  Now JOSM will automatically load the map that you created in Overpass Turbo.

Now that the map is in JOSM, you can delete any roads that have been included that are not in your dataset.  You can use the Edit Toolbar to select and delete roads that you need to.  One thing to keep in mind is that you do not want to upload any of this information to the OSM server.  This will entirely alter any work that someone has done to mark and label an area on an OSM server.  All you will ever want to do is save the current data to your local machine.

Once you have the map edited down to only include the roads in your dataset, save the map to your local machine.  This will be saved as a .osm file.  This file will be used to create additional files that will be used by Omnet, Sumo, and Veins.

